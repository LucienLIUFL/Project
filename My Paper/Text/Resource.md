# 资源管理模块的设计与实现
使用 cocos2d-x 引擎制作游戏的过程当中,不可避免的要使用到多种资源文件,比如用于表示精灵的纹理文件,
用于制作帧动画的图片文件,背景音乐文件.这些文件作为程序的一部分被打包到游戏当中,需要的时候可以加载到内存中.而加载的方式有多种多样,可以从文件中直接加载,也可以采取将资源文件全部加载到资源缓存中,前者具有较好的内存占用,但是因为加载次数太多导致性能的下降,后者采用一次性加载,使用的时候直接从内存中调用,这样减少了性能的开销,但是同样的,加载资源可能在一段时间内不会被使用,导致了一部分内存的浪费,且在大型游戏中,是不可能将所有的资源一次性加载完毕的.因此,在游戏的设计中,往往会采取折中的方式,近期可能遇到的,马上就要使用的资源一次性加载,而不会使用到的暂时不加载.

在我们的游戏设计中,因为资源文件比较少,我们采用一次性将所有的资源全部加载到内存中,但仍然保留部分不常用的(比如按钮图片仅需要加载一次)直接采用文件加载的方式.

因为在整个游戏的编码过程中,同一个文件可能会在工程的不同地方所使用,这样就需要将此文件的路径抄写多次,这样既造成了代码杂乱无章,亦不利于下一步的资源替换和升级,仅仅改动一个资源文件就需要改动多出,而且这种资源缺失而造成的程序 BUG 是非常难以发现和准确定位的,因此,将资源文件出错放到编译期是一个非常好的解决办法.

在我的设计当中,资源管理模块记录所有需要加载的资源文件绝对路径,而其他使用资源的代码在引用 Resource 头文件后,可以使用其字符串常量,这样如果做出资源文件的更改,就只需要更改本模块的内容,且如果删去了部分资源路径,在编译期就可以找到工程中所有的引用.

本模块的设计主要涉及以下几个方面:

1. 使用字符串常量来记录资源文件的绝对路径.记录在 Resource 命名空间内,其他的代码文件通过引用该文件使用其值.
2. 将以 plist 文件格式的图片文件添加到帧缓存, plist 文件是一种 png 图片打包后的文件格式,可以将一组相关的 png 文件打包成一个 png 文件.但是采用这种形式的文件无法直接将图片加载,只能根据 plist 的配置文件将打包后的组合文件拆分后,分别加入到帧缓存当中.
3. 制作帧动画,并加载到帧动画缓存.帧动画是游戏的一个重要组成部分,一个帧动画往往是使用一组相关的静态图片连续播放制作而成,这些图片往往不单独使用,因此在资源加载阶段就将帧动画制作完成,并加载到动画缓存,可以节省大量的资源操作.

## 加载方法的设计

上文已经提到,我们需要提前将一些资源文件加载到内存中,以便于重复使用,或快速创建对象.在这个方面 cocos2d-x 提供了帧缓存,动画缓存和声音缓存来处理我们的需求.这三个缓存的管理对象为单例模式,在整个程序的运行期间只能存在这一个对象,如果一个单例对象已经被初始化,那么对这个类的重复实例化将全部返回这个已经创建好的的对象,只有这个类从未被实例化过,即没有一个此类的对象的情况下,才会进行创建.也就是说,在整个游戏的运行过程中,所有的代码将共享一个对象,这就实现了在这个场景中进行加载,而在所有的场景中都可以使用.

加载方法需要实现的功能有:

1. 加载全部的 plist 文件.
2. 创建飞行动画,这个动画主要是用于表现玩家飞机的动态效果,共有三帧.
[]
3. 创建爆炸动画,这个动画主要用于表现飞机摧毁,共有35帧.
[]
4. 将动画加载到动画缓存,并使用名字记录.

