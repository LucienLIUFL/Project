# 模型设计

雷霆战机游戏中的模型,指的是游戏当中所使用的四种对象,即玩家战机,敌方战机,玩家子弹,地方子弹.
四种对象均继承自 cocos2d-x 引擎的 Sprite 类,并重写其中的一些方法.
在进行我们的模型设计之前,为了更好的说明我们的设计方法,必须对 cocos2d-x 引擎的两段式对象实例化方法有所了解.

## 两段式创建
所谓的两段式,是指将对象的实例化与初始化分离,将类的构造方法设为私有不允许直接进行实例化,创建一个静态的工厂方法进行对象的实例化,因为 cocos2d-x 引擎的内存管理机制,对象的获取与管理全部使用指针进行,因此在实例化时要在堆区进行内存分配,并自动将此内存的管理权托管于 cocos2d-x 的内存池,若创建不成功则需要进行安全删除并返回空指针,初始化代码全部写在类的 init 方法中,此方法在类的工厂方法中进行调用.

采用这样的创建方式,避免了对象因初始化失败,或者渲染的问题而导致构造函数抛出异常而内存无法回收,造成内存泄露.

在我们的模型中,因为同一个类的所有对象都具有相同的纹理和动作,因此我们采用直接将固定的模式写到精灵的初始化方法中,而不需要每次进行创建之后才进行手动添加.

## 敌机子弹与玩家子弹设计

两种子弹的素材展示

[]

在初始化方法中,我们首先进行图片的添加,并启用颜色混合,这样可以使得图片与背景更好的进行混合.
并且要添加移动方法:
1. 玩家子弹从玩家战机的位置开始垂直向上移动,并在移出屏幕外后将自己移除.
2. 敌机子弹从地方战机的位置开始向下垂直移动,并在移出屏幕外后将自己移除.

同时我们需要在这里对两种子弹的物理刚体进行创建,玩家子弹是矩形,创建为矩形刚体,而敌机子弹为圆形,创建为圆形刚体.并且进行碰撞标识的分配,分配的方式以及使用的方法在碰撞检测设计中有详细的介绍,这里不再重复.

## 敌方战机的设计

敌方战机的素材展示

[]

这里共有6中敌方战机模型,虽然其图片是不同的,但是都拥有相同的属性和动作,因此我们将它们归类到同一对象.
我们选择在其创建的时候使用一个 flag 参数来决定创建哪一个敌机,不同的敌机具有不同的图片和 HP 值.

在模型部分,我们不创建敌机的飞行轨迹,因为为了避免单调,我们选择将不同的飞行轨迹与不同类型的敌机进行组合.因此,设计了单独一个模块进行飞行轨迹的创建,在这里也不进行敌机模型的位置设置,一切有关于位置的信息都由轨迹模块进行操作.

除了飞机模型的创建之外,我们需要将部分游戏逻辑在模型中实现,一共要实现以下三个方法:

1. 飞机是否生存,如果被摧毁,则在碰撞处理中会调用相应的过程进行处理,这里不详细描述.
2. 飞机掉血,当碰撞检测接受到飞机的碰撞事件时,会首先调用此方法,然后进行判活.
3. 射击方法,所谓的射击方法是比较形象的说法,实际上是向当前层添加一个子弹对象,子弹对象的创建在上文已经描述.

## 玩家战机的创建

玩家战机的素材展示

[]

我们可以看到,虽然玩家战机只有一种形式,但是是由三张相关的帧组成,也就是说,玩家战机精灵实际上是一个三帧的动画,并使用无限重复的方式播放.

玩家战机的轨迹是由玩家控制,在有关触摸逻辑的部分进行介绍,玩家战机在游戏层创建时会直接初始化.战机同样要实现以下四个方法:

1. 飞机是否生存,如果被摧毁,则在碰撞处理中会调用相应的过程进行处理,玩家战机的摧毁意味着游戏结束.
2. 飞机掉血,当碰撞检测接受到飞机的碰撞事件时,会首先调用此方法,然后进行判活.
3. 射击方法,向当前层添加一个子弹对象.
4. 获取当前生命值.为了在游戏层中可以让玩家直观的感受到剩余生命值,需要设置一个访问器.