# 触摸逻辑模块设计

触摸逻辑是控制用户与手机进行交互的模块,在本游戏中,就是控制玩家战机精灵进行躲避,攻击等一系列的操作.在原先的版本中,我们采用的是使用 Lambda 表达式将逻辑的实现写在场景代码中,在新版本的设计中,为了实现渲染代码与逻辑代码的分离,在层代码中仅仅只进行逻辑事件监听的回调函数注册我将触摸逻辑专门使用一个单独的模块来进行实现.

在事件分发部分中,我们已经了解了进行触摸监听,我们需要重写这四个方法:
onTouchesBegan,onTouchesMoved,onTouchesEnded,onTouchesCancelled.

其中,结束方法与取消方法在我们的游戏中意义不大,我并没有进行重写,仅仅重写了前两个方法,分别是
1. 检测触摸是否发生.
2. 根据触摸对象进行响应.

## 检测触摸是否发生
这个功能主要由事件的 onTouchBegan 属性进行判定,这是一个返回值为布尔类型的回调函数,其作用是,当触摸事件发生时,判断触摸的对象是否是当前所监听的对象.作用原理是,获取当前的触摸坐标,和获取当前的监听对象,将监听对象的位置转换到与触摸坐标的统一坐标系,根据当前监听对象的的大小,创建一个范围盒,最后判断这个范围盒中是否包含触摸点,如果包含,则返回真,否则返回为假.

逻辑流程图的展示如下所示:

[]

## 根据触摸对象进行响应
这个功能主要是由触摸事件的 onTouchMoved 属性进行实现,当 onTouchBegan 的返回值为真时,这个回调函数就会被调用.这个方法的实现需要两个方面,因为触摸事件为连续触摸,连续触摸并非是一条连续的直线,而是由离散的触摸点构成的点集合,点的密集程度由屏幕的采样率决定,鉴于这样的情况,我们所做的第一步就是获取当前触摸点与上一触摸点的距离,这个距离记为 delta,是一个矢量,计算表示如下:

[]

获取距离变化之后,我们需要进行当前监听坐标的位置重设,将当前监听对象的位置重新设置为原先位置加上变化矢量:

[]

